<?xml version="1.0" encoding="UTF-8"?>
<Patch>
  <!--================================ Patches for Vanilla beds ======================================-->
  <Operation Class="PatchOperationAdd">
    <xpath>Defs/ThingDef[defName = "Bed"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
    <value>
      <li>WalledVitalsMonitor</li>
    </value>
  </Operation>
  <Operation Class="PatchOperationAdd">
    <xpath>Defs/ThingDef[defName = "DoubleBed"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
    <value>
      <li>WalledVitalsMonitor</li>
    </value>
  </Operation>
  <Operation Class="PatchOperationAdd">
    <xpath>Defs/ThingDef[defName = "RoyalBed"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
    <value>
      <li>WalledVitalsMonitor</li>
    </value>
  </Operation>
  <Operation Class="PatchOperationAdd">
    <xpath>Defs/ThingDef[defName = "HospitalBed"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
    <value>
      <li>WalledVitalsMonitor</li>
    </value>
  </Operation>
  <Operation Class="PatchOperationAdd">
    <xpath>Defs/ThingDef[defName = "Bedroll"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
    <value>
      <li>WalledVitalsMonitor</li>
    </value>
  </Operation>
  <Operation Class="PatchOperationAdd">
    <xpath>Defs/ThingDef[defName = "BedrollDouble"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
    <value>
      <li>WalledVitalsMonitor</li>
    </value>
  </Operation>
  <Operation Class="PatchOperationConditional">
    <xpath>Defs/ThingDef[defName = "AnimalSleepingBox"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]</xpath>
    <nomatch Class="PatchOperationAdd">
      <xpath>Defs/ThingDef[defName="AnimalSleepingBox"]/comps</xpath>
      <value>
        <li Class="CompProperties_AffectedByFacilities">
          <linkableFacilities>
            <li>WalledVitalsMonitor</li>
            <li>VitalsMonitor</li>
          </linkableFacilities>
        </li>
      </value>
    </nomatch>
    <match Class="PatchOperationAdd">
      <xpath>Defs/ThingDef[defName = "AnimalSleepingBox"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
      <value>
        <li>WalledVitalsMonitor</li>
      </value>
    </match>
  </Operation>
  <Operation Class="PatchOperationConditional">
    <xpath>Defs/ThingDef[defName = "AnimalBed"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]</xpath>
    <nomatch Class="PatchOperationAdd">
      <xpath>Defs/ThingDef[defName="AnimalBed"]/comps</xpath>
      <value>
        <li Class="CompProperties_AffectedByFacilities">
          <linkableFacilities>
            <li>WalledVitalsMonitor</li>
            <li>VitalsMonitor</li>
          </linkableFacilities>
        </li>
      </value>
    </nomatch>
    <match Class="PatchOperationAdd">
      <xpath>Defs/ThingDef[defName = "AnimalBed"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
      <value>
        <li>WalledVitalsMonitor</li>
      </value>
    </match>
  </Operation>
  <!--======================================IF sdMedicAddons is also installed, add walled spacer vitals monitor to vanilla beds===============-->
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>[sd] medicaddons</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName = "Bed"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
          <value>
            <li>WalledVitalsMonitorSpacer</li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName = "DoubleBed"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
          <value>
            <li>WalledVitalsMonitorSpacer</li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName = "RoyalBed"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
          <value>
            <li>WalledVitalsMonitorSpacer</li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName = "HospitalBed"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
          <value>
            <li>WalledVitalsMonitorSpacer</li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName = "Bedroll"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
          <value>
            <li>WalledVitalsMonitorSpacer</li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName = "BedrollDouble"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
          <value>
            <li>WalledVitalsMonitorSpacer</li>
          </value>
        </li>
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName = "AnimalSleepingBox"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]</xpath>
          <nomatch Class="PatchOperationAdd">
            <xpath>Defs/ThingDef[defName="AnimalSleepingBox"]/comps</xpath>
            <value>
              <li Class="CompProperties_AffectedByFacilities">
                <linkableFacilities>
                  <li>WalledVitalsMonitorSpacer</li>
                </linkableFacilities>
              </li>
            </value>
          </nomatch>
          <match Class="PatchOperationAdd">
            <xpath>Defs/ThingDef[defName = "AnimalSleepingBox"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
            <value>
              <li>WalledVitalsMonitorSpacer</li>
            </value>
          </match>
        </li>
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName = "AnimalBed"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]</xpath>
          <nomatch Class="PatchOperationAdd">
            <xpath>Defs/ThingDef[defName="AnimalBed"]/comps</xpath>
            <value>
              <li Class="CompProperties_AffectedByFacilities">
                <linkableFacilities>
                  <li>WalledVitalsMonitorSpacer</li>
                </linkableFacilities>
              </li>
            </value>
          </nomatch>
          <match Class="PatchOperationAdd">
            <xpath>Defs/ThingDef[defName = "AnimalBed"]/comps/li[@Class = "CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
            <value>
              <li>WalledVitalsMonitorSpacer</li>
            </value>
          </match>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
